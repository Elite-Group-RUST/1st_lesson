# Что такое Cargo и как работать с TOML в Visual Studio Code?

## Введение

**Cargo** — это **система сборки** и **менеджер пакетов** для языка программирования **Rust**. Он облегчает создание, компиляцию, тестирование и управление зависимостями проектов на Rust. Cargo автоматизирует многие рутинные задачи и является неотъемлемой частью экосистемы Rust.

**TOML** (Tom's Obvious, Minimal Language) — это формат файлов конфигурации, используемый Cargo для определения зависимостей и настроек проекта. Основной файл конфигурации проекта на Rust называется **`Cargo.toml`**.

В данном руководстве мы рассмотрим:

- Что такое Cargo и как с ним работать.
- Структуру и содержание файла `Cargo.toml`.
- Как работать с файлами TOML в Visual Studio Code.
- Полезные расширения для работы с Rust и TOML в VS Code.

---

## Часть 1: Что такое Cargo?

### Основные функции Cargo

1. **Управление проектами** для создания новых проектов и библиотек.
2. **Управление зависимостями** для добавления, обновления и удаления внешних библиотек (крейтов).
3. **Сборка и компиляция** для компиляции проекта в исполняемый файл или библиотеку.
4. **Тестирование** и запуск модульных и интеграционных тестов.
5. **Публикация** библиотек на [crates.io](https://crates.io/), официальном репозитории крейтов Rust.

### Установка Cargo

Cargo обычно устанавливается вместе с Rust при использовании инструмента установки **rustup**.

#### Шаг 1: Установите Rust и Cargo

```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

Следуйте инструкциям установщика. После установки проверьте версию Cargo:

```bash
cargo --version
```

### Создание нового проекта с помощью Cargo

#### Шаг 1: Создайте новый проект

```bash
cargo new my_project
```

Это создаст директорию `my_project` со следующей структурой:

```plaintext
my_project/
├── Cargo.toml
└── src
    └── main.rs
```

- **`Cargo.toml`**: файл конфигурации проекта.
- **`src/main.rs`**: основной файл исходного кода.

#### Шаг 2: Перейдите в директорию проекта

```bash
cd my_project
```

#### Шаг 3: Запустите проект

```bash
cargo run
```

Вывод:

```
   Compiling my_project v0.1.0 (/path/to/my_project)
    Finished dev [unoptimized + debuginfo] target(s) in 1.0s
     Running `target/debug/my_project`
Hello, world!
```

### Основные команды Cargo

- **`cargo build`**: компилирует проект.
- **`cargo run`**: компилирует и запускает проект.
- **`cargo test`**: запускает тесты.
- **`cargo clean`**: очищает скомпилированные файлы.
- **`cargo update`**: обновляет версии зависимостей в соответствии с требованиями.

---

## Часть 2: Структура и содержание файла `Cargo.toml`

Файл `Cargo.toml` — это файл конфигурации проекта, написанный в формате TOML. Он содержит информацию о проекте, его зависимостях и настройках сборки.

### Пример `Cargo.toml`

```toml
[package]
name = "my_project"
version = "0.1.0"
authors = ["Ваше Имя <email@example.com>"]
edition = "2021"

[dependencies]
serde = { version = "1.0", features = ["derive"] }
```

### Разделы файла `Cargo.toml`

- **`[package]`**: информация о пакете.
  - `name`: имя пакета.
  - `version`: версия пакета.
  - `authors`: авторы проекта.
  - `edition`: версия языка Rust (например, "2018" или "2021").
- **`[dependencies]`**: список зависимостей.
  - Здесь перечисляются внешние крейты, необходимые вашему проекту.
- **`[dev-dependencies]`**: зависимости, используемые только для разработки и тестирования.
- **`[build-dependencies]`**: зависимости, используемые в скриптах сборки.

### Добавление зависимостей

Вы можете добавить зависимость вручную, отредактировав `Cargo.toml`, или используя команду `cargo add` (требует установки дополнения `cargo-edit`).

#### Способ 1: Ручное добавление

```toml
[dependencies]
rand = "0.8"
```

#### Способ 2: Использование `cargo add`

Установите `cargo-edit`:

```bash
cargo install cargo-edit
```

Добавьте зависимость:

```bash
cargo add rand
```

### Версии зависимостей

Вы можете указывать версии зависимостей с использованием спецификаторов:

- **Точное соответствие**: `serde = "=1.0.130"`
- **Совместимые обновления по умолчанию**: `serde = "1.0"`
- **Диапазон версий**: `serde = ">=1.0, <2.0"`

---

## Часть 3: Работа с TOML в Visual Studio Code

### Что такое TOML?

TOML (Tom's Obvious, Minimal Language) — это формат файла конфигурации, который отличается простотой и читаемостью. Он использует синтаксис, похожий на INI-файлы, но с поддержкой более сложных типов данных.

### Открытие и редактирование `Cargo.toml` в VS Code

1. **Открытие проекта в VS Code**: Запустите Visual Studio Code и выберите **File > Open Folder**, затем выберите директорию вашего проекта (`my_project`).

2. **Открытие файла `Cargo.toml`**: В проводнике файлов VS Code (`Explorer`) найдите файл `Cargo.toml` и откройте его.

### Подсветка синтаксиса и автодополнение

Для удобной работы с файлами TOML в VS Code рекомендуется установить расширение **Better TOML**.

#### Установка расширения Better TOML

1. Нажмите на иконку расширений в боковой панели VS Code (или используйте сочетание клавиш `Ctrl+Shift+X`).
2. Введите в поле поиска "Better TOML".
3. Выберите расширение **Better TOML** от автора `bungcip` и нажмите **Install**.

После установки расширения вы получите:

- **Подсветку синтаксиса** для файлов TOML.
- **Автодополнение** и проверку синтаксиса.
- **Форматирование** кода с помощью `Ctrl+Shift+I`.

### Работа с Rust в VS Code

Для полноценной поддержки Rust в VS Code рекомендуется установить расширение **rust-analyzer**.

#### Установка расширения rust-analyzer

1. Откройте менеджер расширений (`Ctrl+Shift+X`).
2. Введите "rust-analyzer" в поле поиска.
3. Выберите расширение **rust-analyzer** от `rust-lang` и нажмите **Install**.

Расширение `rust-analyzer` предоставляет:

- **Подсветку синтаксиса** и **автодополнение** для Rust.
- **Переход к определениям** (`Go to Definition`).
- **Подсказки типов** и **выявление ошибок** в реальном времени.
- **Интеграцию с Cargo**: запуск сборки, тестов и т.д.

### Форматирование кода

Для автоматического форматирования кода Rust можно использовать инструмент **rustfmt**.

#### Установка rustfmt

```bash
rustup component add rustfmt
```

#### Настройка форматирования в VS Code

1. Откройте **Settings** (`Ctrl+,`).
2. В поле поиска введите "rust-analyzer".
3. Найдите опцию **"Rust-analyzer: Enable Enhanced Formatting"** и убедитесь, что она включена.
4. Настройте автоформатирование при сохранении файла:
   - В поиске настроек введите "Format On Save".
   - Включите опцию **"Editor: Format On Save"**.

Теперь при сохранении файла код будет автоматически форматироваться согласно стандартам Rust.

### Работа с терминалом в VS Code

Вы можете использовать встроенный терминал VS Code для выполнения команд Cargo:

1. Откройте терминал (`Ctrl+``).
2. Выполняйте команды Cargo прямо в терминале:

```bash
cargo build
cargo run
cargo test
```

---

## Часть 4: Практические примеры

### Добавление зависимости и использование её в коде

#### Шаг 1: Добавьте зависимость

Добавим зависимость `rand` для генерации случайных чисел.

В `Cargo.toml`:

```toml
[dependencies]
rand = "0.8"
```

#### Шаг 2: Обновите зависимости

```bash
cargo update
```

#### Шаг 3: Используйте зависимость в коде

В `src/main.rs`:

```rust
use rand::Rng;

fn main() {
    let mut rng = rand::thread_rng();
    let n: u8 = rng.gen_range(1..101);
    println!("Случайное число: {}", n);
}
```

#### Шаг 4: Запустите программу

```bash
cargo run
```

Вывод:

```
Случайное число: 42
```

### Использование другого издания Rust

Если вы хотите использовать более новую или старую версию издания Rust, измените поле `edition` в `Cargo.toml`.

Пример:

```toml
[package]
name = "my_project"
version = "0.1.0"
edition = "2021"
```

Доступные издания: "2015", "2018", "2021".

---

## Заключение

**Cargo** — незаменимый инструмент для разработчиков на Rust. Он упрощает процесс создания и управления проектами, позволяя сосредоточиться на написании кода.

**TOML** — простой и удобный формат для файлов конфигурации. С помощью расширения **Better TOML** в Visual Studio Code вы можете комфортно работать с `Cargo.toml`, получая подсветку синтаксиса и проверку ошибок.

**Visual Studio Code** с расширениями **rust-analyzer** и **Better TOML** превращается в мощную среду разработки для Rust, предоставляя все необходимые инструменты для эффективной работы.

---

## Дополнительные ресурсы

- **Официальная документация Rust**: [https://www.rust-lang.org/ru](https://www.rust-lang.org/ru)
- **Документация Cargo**: [https://doc.rust-lang.org/cargo/](https://doc.rust-lang.org/cargo/)
- **Справочник по Cargo.toml**: [https://doc.rust-lang.org/cargo/reference/manifest.html](https://doc.rust-lang.org/cargo/reference/manifest.html)
- **Расширение rust-analyzer**: [https://marketplace.visualstudio.com/items?itemName=rust-lang.rust-analyzer](https://marketplace.visualstudio.com/items?itemName=rust-lang.rust-analyzer)
- **Расширение Better TOML**: [https://marketplace.visualstudio.com/items?itemName=bungcip.better-toml](https://marketplace.visualstudio.com/items?itemName=bungcip.better-toml)

---

## Практические советы

- **Используйте расширения VS Code**, они значительно облегчают процесс разработки.
- **Следите за версиями зависимостей** и регулярно обновляйте зависимости и следите за изменениями.
- **Изучайте формат TOML**, для понимания его синтаксиса чтобы более точно управлять настройками проекта.
- **Пишите тесты** и используйте `cargo test` для обеспечения качества вашего кода.

---

**Успехов в разработке на Rust!**