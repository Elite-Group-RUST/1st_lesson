# Модификаторы доступа в Rust

В Rust модификаторы доступа управляют **видимостью** элементов кода (функций, структур, методов, модулей и т.д.) в разных частях программы. Понимание модификаторов доступа важно для организации кода, создания библиотек и обеспечения инкапсуляции.

В этом разделе мы рассмотрим:

- **Понятие видимости в Rust**
- **Модификаторы доступа**
  - По умолчанию (private)
  - `pub` (public)
  - `pub(crate)`
  - `pub(super)`
  - `pub(in path)`
- **Применение модификаторов доступа**
  - К функциям
  - К структурам и их полям
  - К перечислениям и их вариантам
  - К модулям
- **Практические примеры**
- **Советы по использованию модификаторов доступа**

---

## Понятие видимости в Rust

Видимость определяет, какие части кода могут обращаться к определённому элементу (функции, структуре и т.д.). Это помогает контролировать доступ и обеспечивает инкапсуляцию.

- Частные **(private)** элементы доступны только внутри текущего модуля и его подмодулей.
- Публичные **(public)** элементы доступны из других модулей и крейтов, в зависимости от уровня доступа.

---

## Модификаторы доступа

### По умолчанию (private)

В Rust все элементы по умолчанию являются **частными** (private). Это означает, что после объявления они доступны только внутри текущего модуля и его подмодулей.

#### Пример

```rust
mod my_module {
    fn private_function() {
        println!("Это частная функция");
    }
}
```

Здесь `private_function` доступна только внутри `my_module`.

### `pub` (public)

Ключевое слово `pub` делает элемент **публичным**, то есть доступным за пределами текущего модуля.

#### Пример

```rust
mod my_module {
    pub fn public_function() {
        println!("Это публичная функция");
    }
}

fn main() {
    my_module::public_function(); // Доступно
}
```

### `pub(crate)`

Ключевое слово `pub(crate)` делает элемент доступным во всём текущем **крейтe** (crate), но не за его пределами.

#### Пример

```rust
mod my_module {
    pub(crate) fn crate_function() {
        println!("Функция доступна во всём крейте");
    }
}
```

При использовании `pub(crate)` функция `crate_function` будет доступна из любого модуля внутри текущего крейта, но не из внешних крейтов.

### `pub(super)`

Ключевое слово `pub(super)` делает элемент доступным в **родительском модуле**.

#### Пример

```rust
mod parent_module {
    mod child_module {
        pub(super) fn parent_function() {
            println!("Доступно в родительском модуле");
        }
    }

    fn main_in_parent() {
        child_module::parent_function(); // Доступно
    }
}
```

### `pub(in path)`

Ключевое слово `pub(in path)` позволяет задать видимость элемента в определённом **модуле или пространстве имён**.

#### Пример

```rust
mod a {
    pub mod b {
        pub(in crate::a) fn function_in_a() {
            println!("Доступно в модуле a");
        }
    }

    fn test_function() {
        b::function_in_a(); // Доступно
    }
}

mod c {
    fn test_function() {
        // a::b::function_in_a(); // Ошибка: функция не доступна в модуле c
    }
}
```

---

## Применение модификаторов доступа

### Функции

Модификаторы доступа применяются непосредственно перед объявлением функции.

#### Пример

```rust
mod utils {
    pub fn public_util() {
        println!("Публичная утилита");
    }

    fn private_util() {
        println!("Частная утилита");
    }
}

fn main() {
    utils::public_util(); // Доступно
    // utils::private_util(); // Ошибка: функция private_util не доступна
}
```

### Структуры и их поля

По умолчанию структуры являются частными. Используя `pub`, можно сделать структуру и её поля публичными.

#### Пример: Публичная структура с публичными полями

```rust
mod models {
    pub struct PublicStruct {
        pub field1: i32,
        pub field2: String,
    }
}

fn main() {
    let instance = models::PublicStruct {
        field1: 10,
        field2: String::from("Привет"),
    };
    println!("field1: {}", instance.field1);
}
```

#### Пример: Публичная структура с частными полями

```rust
mod models {
    pub struct SemiPrivateStruct {
        pub field1: i32,
        field2: String, // Поле частное
    }

    impl SemiPrivateStruct {
        pub fn new(field1: i32, field2: String) -> Self {
            Self { field1, field2 }
        }
    }
}

fn main() {
    let instance = models::SemiPrivateStruct::new(10, String::from("Привет"));
    println!("field1: {}", instance.field1);
    // println!("field2: {}", instance.field2); // Ошибка: поле field2 не доступно
}
```

### Перечисления и их варианты

Если перечисление объявлено как `pub`, то все его варианты автоматически становятся публичными.

#### Пример

```rust
mod status {
    pub enum Status {
        Active,
        Inactive,
    }
}

fn main() {
    let s = status::Status::Active;
}
```

Если необходимо ограничить доступ к вариантам, нужно делать перечисление частным и предоставлять публичные функции для создания экземпляров.

### Модули

Модули по умолчанию являются частными. Используя `pub mod`, можно сделать модуль публичным.

#### Пример

```rust
pub mod network {
    pub fn connect() {
        println!("Подключение к сети");
    }
}
```

Теперь модуль `network` и функция `connect` доступны из других модулей и крейтов.

---

## Практические примеры

### Пример 1: Библиотека с публичным интерфейсом

```rust
// lib.rs

pub mod math {
    pub fn add(a: i32, b: i32) -> i32 {
        a + b
    }

    fn subtract(a: i32, b: i32) -> i32 {
        a - b
    }
}
```

В этом примере функция `add` является публичной и доступна из других крейтов, а `subtract` — частная и доступна только внутри модуля `math`.

### Пример 2: Управление доступом в нескольких уровнях модулей

```rust
mod outer {
    pub mod inner {
        pub fn public_inner_function() {
            println!("Публичная внутренняя функция");
        }

        fn private_inner_function() {
            println!("Частная внутренняя функция");
        }
    }

    fn test_outer() {
        inner::public_inner_function(); // Доступно
        // inner::private_inner_function(); // Ошибка
    }
}

fn main() {
    outer::inner::public_inner_function(); // Доступно
    // outer::inner::private_inner_function(); // Ошибка
}
```

### Пример 3: Использование `pub(crate)` для ограничения доступа

```rust
mod helpers {
    pub(crate) fn internal_helper() {
        println!("Внутренняя функция помощник");
    }
}

fn main() {
    helpers::internal_helper(); // Доступно внутри крейта
}
```

Если кто-то попытается вызвать `helpers::internal_helper()` из другого крейта, то получит ошибку компиляции.

---

## Советы по использованию модификаторов доступа

- Используйте **инкапсуляцию** и скрывайте детали реализации, предоставляя публичный интерфейс. Это упрощает поддержку кода и предотвращает неправильное использование.
- **Необходимый доступ** к данным предоставляйте только тогда, когда действительно необходим.
- Делайте поля структуры **частными**, предоставляя методы для доступа. Это позволяет контролировать, как данные изменяются.
- **Использование `pub(crate)`** допускается тогда, когда функция или модуль должны быть доступны во всём крейте, но не снаружи, используйте `pub(crate)`.
- Структурируйте код в модули и подмодули, используя модификаторы доступа для управления видимостью.